<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">
<head>
<title>Enabling DNSSEC on OpenWrt - Kyle's Wiki</title>
<meta charset="UTF-8" />
<meta name="generator" content="MediaWiki 1.19.1" />
<meta name="robots" content="noindex,nofollow" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch_desc.php" title="Kyle's Wiki (en)" />
<link rel="EditURI" type="application/rsd+xml" href="http://wiki.xkyle.com/api.php?action=rsd" />
<link rel="copyright" href="http://creativecommons.org/licenses/by-sa/3.0/" />
<link rel="alternate" type="application/atom+xml" title="Kyle's Wiki Atom feed" href="/index.php?title=Special:RecentChanges&amp;feed=atom" />
<link rel="stylesheet" href="http://wiki.xkyle.com/load.php?debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cskins.vector&amp;only=styles&amp;skin=vector&amp;*" />
<meta name="ResourceLoaderDynamicStyles" content="" />
<style>a:lang(ar),a:lang(ckb),a:lang(fa),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}a.new,#quickbar a.new{color:#ba0000}

/* cache key: my_wiki:resourceloader:filter:minify-css:7:c88e2bcd56513749bec09a7e29cb3ffa */
</style>

<script src="http://wiki.xkyle.com/load.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=vector&amp;*"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Enabling_DNSSEC_on_OpenWrt","wgTitle":"Enabling DNSSEC on OpenWrt","wgCurRevisionId":2813,"wgArticleId":410,"wgIsArticle":true,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["OpenWrt","DNSSEC"],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgRelevantPageName":"Enabling_DNSSEC_on_OpenWrt","wgRestrictionEdit":[],"wgRestrictionMove":[]});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function($){mw.user.options.set({"ccmeonemails":0,"cols":80,"date":"default","diffonly":0,"disablemail":0,"disablesuggest":0,"editfont":"default","editondblclick":0,"editsection":1,"editsectiononrightclick":0,"enotifminoredits":0,"enotifrevealaddr":0,"enotifusertalkpages":1,"enotifwatchlistpages":0,"extendwatchlist":0,"externaldiff":0,"externaleditor":0,"fancysig":0,"forceeditsummary":0,"gender":"unknown","hideminor":0,"hidepatrolled":0,"highlightbroken":1,"imagesize":2,"justify":0,"math":1,"minordefault":0,"newpageshidepatrolled":0,"nocache":0,"noconvertlink":0,"norollbackdiff":0,"numberheadings":0,"previewonfirst":0,"previewontop":1,"quickbar":5,"rcdays":7,"rclimit":50,"rememberpassword":0,"rows":25,"searchlimit":20,"showhiddencats":0,"showjumplinks":1,"shownumberswatching":1,"showtoc":1,"showtoolbar":1,"skin":"vector","stubthreshold":0,"thumbsize":2,"underline":2,"uselivepreview":0,"usenewrc":0,"watchcreations":0,"watchdefault":0,"watchdeletion":0,
"watchlistdays":3,"watchlisthideanons":0,"watchlisthidebots":0,"watchlisthideliu":0,"watchlisthideminor":0,"watchlisthideown":0,"watchlisthidepatrolled":0,"watchmoves":0,"wllimit":250,"variant":"en","language":"en","searchNs0":true,"searchNs1":false,"searchNs2":false,"searchNs3":false,"searchNs4":false,"searchNs5":false,"searchNs6":false,"searchNs7":false,"searchNs8":false,"searchNs9":false,"searchNs10":false,"searchNs11":false,"searchNs12":false,"searchNs13":false,"searchNs14":false,"searchNs15":false});;},{},{});mw.loader.implement("user.tokens",function($){mw.user.tokens.set({"editToken":"+\\","watchToken":false});;},{},{});

/* cache key: my_wiki:resourceloader:filter:minify-js:7:9983699ab6150ffa89a90653b2338ac8 */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax"]);
}</script>
<!--[if lt IE 7]><style type="text/css">body{behavior:url("/skins/vector/csshover.min.htc")}</style><![endif]--><!-- start Mixpanel --><script type="text/javascript">(function(e,b){if(!b.__SV){var a,f,i,g;window.mixpanel=b;a=e.createElement("script");a.type="text/javascript";a.async=!0;a.src=("https:"===e.location.protocol?"https:":"http:")+'//cdn.mxpnl.com/libs/mixpanel-2.2.min.js';f=e.getElementsByTagName("script")[0];f.parentNode.insertBefore(a,f);b._i=[];b.init=function(a,e,d){function f(b,h){var a=h.split(".");2==a.length&&(b=b[a[0]],h=a[1]);b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}var c=b;"undefined"!==
typeof d?c=b[d]=[]:d="mixpanel";c.people=c.people||[];c.toString=function(b){var a="mixpanel";"mixpanel"!==d&&(a+="."+d);b||(a+=" (stub)");return a};c.people.toString=function(){return c.toString(1)+".people (stub)"};i="disable track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.track_charge people.clear_charges people.delete_user".split(" ");for(g=0;g<i.length;g++)f(c,i[g]);
b._i.push([a,e,d])};b.__SV=1.2}})(document,window.mixpanel||[]);
mixpanel.init("f49fd1e08211929444aad692b8995519");mixpanel.track('pageload')</script><!-- end Mixpanel --></head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Enabling_DNSSEC_on_OpenWrt skin-vector action-view">
		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<!-- content -->
		<div id="content" class="mw-body">
			<a id="top"></a>
			<div id="mw-js-message" style="display:none;"></div>
						<!-- firstHeading -->
			<h1 id="firstHeading" class="firstHeading">
				<span dir="auto">Enabling DNSSEC on OpenWrt</span>
			</h1>
			<!-- /firstHeading -->
			<!-- bodyContent -->
			<div id="bodyContent">
								<!-- tagline -->
				<div id="siteSub">From Kyle&#039;s Wiki</div>
				<!-- /tagline -->
								<!-- subtitle -->
				<div id="contentSub"><div id="mw-revision-info">Revision as of 15:33, 4 December 2012 by <a href="/User:Kyle" title="User:Kyle" class="mw-userlink">Kyle</a>  <span class="mw-usertoollinks">(<a href="/index.php?title=User_talk:Kyle&amp;action=edit&amp;redlink=1" class="new" title="User talk:Kyle (page does not exist)">Talk</a> | <a href="/Special:Contributions/Kyle" title="Special:Contributions/Kyle">contribs</a>)</span></div><br />
				<div id="mw-revision-nav">(<a href="/index.php?title=Enabling_DNSSEC_on_OpenWrt&amp;diff=prev&amp;oldid=2813" title="Enabling DNSSEC on OpenWrt">diff</a>) <a href="/index.php?title=Enabling_DNSSEC_on_OpenWrt&amp;direction=prev&amp;oldid=2813" title="Enabling DNSSEC on OpenWrt">← Older revision</a> | Latest revision (diff) | Newer revision → (diff)</div></div>
				<!-- /subtitle -->
																<!-- jumpto -->
				<div id="jump-to-nav" class="mw-jump">
					Jump to: <a href="#mw-head">navigation</a>,
					<a href="#p-search">search</a>
				</div>
				<!-- /jumpto -->
								<!-- bodycontent -->
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><p>Openwrt's default dns "server" is dnsmasq. It is what is called a "stub resolver", where it simply forwards dns queries to the dns servers that you get from your cable modem's dhcp. It itself cannot do DNSSEC functions, but it will forward on dnssec to the client as long as the upstream dns server is DNSSEC aware.
</p>
<table id="toc" class="toc"><tr><td><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Pre_Test"><span class="tocnumber">1</span> <span class="toctext">Pre Test</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Test_Your_Upstream_DNSSEC_Server"><span class="tocnumber">2</span> <span class="toctext">Test Your Upstream DNSSEC Server</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Make_That_Change"><span class="tocnumber">3</span> <span class="toctext">Make That Change</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Test"><span class="tocnumber">4</span> <span class="toctext">Test</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Summary"><span class="tocnumber">5</span> <span class="toctext">Summary</span></a></li>
</ul>
</td></tr></table>
<h3> <span class="mw-headline" id="Pre_Test"> Pre Test </span></h3>
<p>First, ask your local server a dnssec question:
</p><p>cody@cody-laptop2:~$ dig @10.0.2.254 +dnssec debian.org
</p>
<pre>
; &lt;&lt;&gt;&gt; DiG 9.7.3 &lt;&lt;&gt;&gt; @10.0.2.254 +dnssec debian.org
; (1 server found)
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 20738
;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags: do; udp: 4000
;; QUESTION SECTION:
;debian.org.			IN	A

;; ANSWER SECTION:
debian.org.		3569	IN	A	128.31.0.51
debian.org.		3569	IN	A	206.12.19.7

;; Query time: 48 msec
;; SERVER: 10.0.2.254#53(10.0.2.254)
;; WHEN: Sun Jul 17 08:26:02 2011
;; MSG SIZE  rcvd: 71
</pre>
<p>Things to note here:
</p>
<ul><li> No RRSIG in the response.
</li><li> No ad bit in the flags section
</li><li> I don't know if this is actually debians ip address...
</li></ul>
<h3> <span class="mw-headline" id="Test_Your_Upstream_DNSSEC_Server"> Test Your Upstream DNSSEC Server </span></h3>
<p>I'm lucky that Comcast is on the ball with regards to DNSSEC, and they provide 75.75.75.75 and 75.75.76.76 as DNSSEC aware validating resolvers. They are not pushing these out via DHCP to everyone just yet though...
</p><p>Lets make sure they work:
</p>
<pre>

cody@cody-laptop2:~$ dig @75.75.75.75 +dnssec debian.org

; &lt;&lt;&gt;&gt; DiG 9.7.3 &lt;&lt;&gt;&gt; @75.75.75.75 +dnssec debian.org
; (1 server found)
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 9556
;; flags: qr rd ra ad; QUERY: 1, ANSWER: 3, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags: do; udp: 4000
;; QUESTION SECTION:
;debian.org.			IN	A

;; ANSWER SECTION:
debian.org.		3600	IN	A	128.31.0.51
debian.org.		3600	IN	A	206.12.19.7
debian.org.		3600	IN	RRSIG	A 7 2 3600 20110813220550 20110716220550 12650 debian.org. d97ki0CKfhdmyegQ0dwcunkow4f3986EyKK/hXTE/22DhjPmC9Oe4egv pAKaR9iA0qXnwksFA4oVIhV1nTYuCTH8KAOO3jNq3f3to2T4jFyteGBJ +teOaZgBlXLjiYVzg9WzN3bvYbbX4GH0h2KLG13fS5bbyq6FOfbe/Itp JNjVzpEU/lOLqdacZpwlga+3

;; Query time: 95 msec
;; SERVER: 75.75.75.75#53(75.75.75.75)
;; WHEN: Sun Jul 17 08:24:44 2011
;; MSG SIZE  rcvd: 257
</pre>
<p>Things to note:
</p>
<ul><li> ad (authenticated data) flag <b>is</b> set.
</li><li> RRSIG is there
</li><li> Of course I'm trusting 75.75.75.75, but it isn't trusting anybody!&#160;:)
</li></ul>
<h3> <span class="mw-headline" id="Make_That_Change"> Make That Change </span></h3>
<p>So we know that 75.75.75.75 (or whatever you are using) <b>can</b> do DNSSEC. All we have to do is tell dnsmasq on Openwrt to use it! Through the magic of UCI:
</p>
<pre>
uci set network.wan.dns=75.75.75.75
uci commit
reboot
</pre>
<p>Or just edit /etc/config/network like this:
</p>
<pre>
#### WAN configuration
config interface        wan
        option ifname   &quot;eth0.1&quot;
        option proto    dhcp
        option dns      75.75.75.75
</pre>
<p>You can't just restart dnsmasq here because this setting isn't for dnsmasq, it is for Openwrt. It specifies that it should ignore the incoming dns server from the dhcp lease.
</p>
<h3> <span class="mw-headline" id="Test"> Test </span></h3>
<p>If you are using a modern openwrt (backfire), then that really should be it:
</p>
<pre>
cody@cody-laptop2:~$ dig @10.0.2.254 +dnssec debian.org

; &lt;&lt;&gt;&gt; DiG 9.7.3 &lt;&lt;&gt;&gt; @10.0.2.254 +dnssec debian.org
; (1 server found)
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 53893
;; flags: qr rd ra ad; QUERY: 1, ANSWER: 3, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags: do; udp: 4000
;; QUESTION SECTION:
;debian.org.			IN	A

;; ANSWER SECTION:
debian.org.		1722	IN	A	206.12.19.7
debian.org.		1722	IN	A	128.31.0.51
debian.org.		1722	IN	RRSIG	A 7 2 3600 20110813220550 20110716220550 12650 debian.org. d97ki0CKfhdmyegQ0dwcunkow4f3986EyKK/hXTE/22DhjPmC9Oe4egv pAKaR9iA0qXnwksFA4oVIhV1nTYuCTH8KAOO3jNq3f3to2T4jFyteGBJ +teOaZgBlXLjiYVzg9WzN3bvYbbX4GH0h2KLG13fS5bbyq6FOfbe/Itp JNjVzpEU/lOLqdacZpwlga+3

;; Query time: 56 msec
;; SERVER: 10.0.2.254#53(10.0.2.254)
;; WHEN: Sun Jul 17 08:56:01 2011
;; MSG SIZE  rcvd: 257
</pre>
<h3> <span class="mw-headline" id="Summary"> Summary </span></h3>
<p>All we did is change our upstream dns server to a DNSSEC aware one. This wiki page is 1% configuration and 99% explanation.
</p>
<!-- 
NewPP limit report
Preprocessor node count: 64/1000000
Post-expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Expensive parser function count: 0/100
-->

<!-- Saved in parser cache with key my_wiki:pcache:idhash:410-0!*!*!!en!*!* and timestamp 20140525080837 -->
</div>				<!-- /bodycontent -->
								<!-- printfooter -->
				<div class="printfooter">
				Retrieved from "<a href="http://wiki.xkyle.com/index.php?title=Enabling_DNSSEC_on_OpenWrt&amp;oldid=2813">http://wiki.xkyle.com/index.php?title=Enabling_DNSSEC_on_OpenWrt&amp;oldid=2813</a>"				</div>
				<!-- /printfooter -->
												<!-- catlinks -->
				<div id='catlinks' class='catlinks'><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="/Special:Categories" title="Special:Categories">Categories</a>: <ul><li><a href="/Category:OpenWrt" title="Category:OpenWrt">OpenWrt</a></li><li><a href="/index.php?title=Category:DNSSEC&amp;action=edit&amp;redlink=1" class="new" title="Category:DNSSEC (page does not exist)">DNSSEC</a></li></ul></div></div>				<!-- /catlinks -->
												<div class="visualClear"></div>
				<!-- debughtml -->
								<!-- /debughtml -->
			</div>
			<!-- /bodyContent -->
		</div>
		<!-- /content -->
		<!-- header -->
		<div id="mw-head" class="noprint">
			
<!-- 0 -->
<div id="p-personal" class="">
	<h5>Personal tools</h5>
	<ul>
		<li id="pt-login"><a href="/index.php?title=Special:UserLogin&amp;returnto=Enabling+DNSSEC+on+OpenWrt&amp;returntoquery=oldid%3D2813" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>
	</ul>
</div>

<!-- /0 -->
			<div id="left-navigation">
				
<!-- 0 -->
<div id="p-namespaces" class="vectorTabs">
	<h5>Namespaces</h5>
	<ul>
					<li  id="ca-nstab-main" class="selected"><span><a href="/Enabling_DNSSEC_on_OpenWrt"  title="View the content page [c]" accesskey="c">Page</a></span></li>
					<li  id="ca-talk" class="new"><span><a href="/index.php?title=Talk:Enabling_DNSSEC_on_OpenWrt&amp;action=edit&amp;redlink=1"  title="Discussion about the content page [t]" accesskey="t">Discussion</a></span></li>
			</ul>
</div>

<!-- /0 -->

<!-- 1 -->
<div id="p-variants" class="vectorMenu emptyPortlet">
	<h4>
		</h4>
	<h5><span>Variants</span><a href="#"></a></h5>
	<div class="menu">
		<ul>
					</ul>
	</div>
</div>

<!-- /1 -->
			</div>
			<div id="right-navigation">
				
<!-- 0 -->
<div id="p-views" class="vectorTabs">
	<h5>Views</h5>
	<ul>
					<li id="ca-view" class="selected"><span><a href="/Enabling_DNSSEC_on_OpenWrt" >Read</a></span></li>
					<li id="ca-viewsource"><span><a href="/index.php?title=Enabling_DNSSEC_on_OpenWrt&amp;action=edit"  title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li>
					<li id="ca-history" class="collapsible"><span><a href="/index.php?title=Enabling_DNSSEC_on_OpenWrt&amp;action=history"  title="Past revisions of this page [h]" accesskey="h">View history</a></span></li>
			</ul>
</div>

<!-- /0 -->

<!-- 1 -->
<div id="p-cactions" class="vectorMenu emptyPortlet">
	<h5><span>Actions</span><a href="#"></a></h5>
	<div class="menu">
		<ul>
					</ul>
	</div>
</div>

<!-- /1 -->

<!-- 2 -->
<div id="p-search">
	<h5><label for="searchInput">Search</label></h5>
	<form action="/index.php" id="searchform">
				<div>
			<input type="search" name="search" title="Search Kyle's Wiki [f]" accesskey="f" id="searchInput" />			<input type="submit" name="go" value="Go" title="Go to a page with this exact name if exists" id="searchGoButton" class="searchButton" />			<input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton" />					<input type='hidden' name="title" value="Special:Search"/>
		</div>
	</form>
</div>

<!-- /2 -->
			</div>
		</div>
		<!-- /header -->
		<!-- panel -->
			<div id="mw-panel" class="noprint">
				<!-- logo -->
					<div id="p-logo"><a style="background-image: url(http://wiki.xkyle.com/images/logo.jpg);" href="/Main_Page"  title="Visit the main page"></a></div>
				<!-- /logo -->
				
<!-- Efforts -->
<div class="portal" id='p-Efforts'>
	<h5>Efforts</h5>
	<div class="body">
		<ul>
			<li id="n-Plug-Computers"><a href="/Plug_Computers">Plug Computers</a></li>
			<li id="n-Hack-This-Site"><a href="/Hack_This_Site">Hack This Site</a></li>
			<li id="n-Games-Magazine"><a href="/Games_Magazine">Games Magazine</a></li>
			<li id="n-CFEngine"><a href="/Category:CFEngine">CFEngine</a></li>
			<li id="n-Puppet"><a href="/Category:Puppet">Puppet</a></li>
			<li id="n-BackupPC"><a href="/Category:BackupPC">BackupPC</a></li>
			<li id="n-IPv6"><a href="/Category:IPv6">IPv6</a></li>
		</ul>
	</div>
</div>

<!-- /Efforts -->

<!-- SEARCH -->

<!-- /SEARCH -->

<!-- TOOLBOX -->
<div class="portal" id='p-tb'>
	<h5>Toolbox</h5>
	<div class="body">
		<ul>
			<li id="t-whatlinkshere"><a href="/Special:WhatLinksHere/Enabling_DNSSEC_on_OpenWrt" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
			<li id="t-recentchangeslinked"><a href="/Special:RecentChangesLinked/Enabling_DNSSEC_on_OpenWrt" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
			<li id="t-specialpages"><a href="/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
			<li><a href="/index.php?title=Enabling_DNSSEC_on_OpenWrt&amp;oldid=2813&amp;printable=yes" rel="alternate">Printable version</a></li>
			<li id="t-permalink"><a href="/index.php?title=Enabling_DNSSEC_on_OpenWrt&amp;oldid=2813" title="Permanent link to this revision of the page">Permanent link</a></li>
		</ul>
	</div>
</div>

<!-- /TOOLBOX -->

<!-- LANGUAGES -->

<!-- /LANGUAGES -->
                                <div class="portal" id='p-Meta'>

                                <h5>Meta</h5>
                                <div class="body">
                                        <ul>
                                                <li id="n-About-this-Wiki"><a href="/About">About this Wiki</a></li>
                                                <li id="n-Email-Me"><a href="mailto:kyle@xkyle.com">Email Me</a></li>
                                                <li id="n-Blog"><a href="https://xkyle.com/">My Blog</a></li>
                                                <li id="n-Code"><a href="https://github.com/solarkennedy">Code (github)</a></li>
                                                <li id="n-LinkedIn"><a href="http://www.linkedin.com/pub/kyle-anderson/6/671/2b0">LinkedIn</a></li>
                                                <li id="n-Google+"><a href="https://plus.google.com/u/0/115227890884261811459" rel="author">Google+</a><li>
                                        </ul>
                                </div>
                                </div>

			</div>
		<!-- /panel -->
		<!-- footer -->
                <div id="footer">
                        <div style="clear:both"></div>
                </div>

		<!-- /footer -->
		<script src="http://wiki.xkyle.com/load.php?debug=false&amp;lang=en&amp;modules=skins.vector&amp;only=scripts&amp;skin=vector&amp;*"></script>
<script>if(window.mw){
mw.loader.load(["mediawiki.user","mediawiki.page.ready"], null, true);
}</script>
<!-- Served in 0.383 secs. -->
	</body>
</html>
